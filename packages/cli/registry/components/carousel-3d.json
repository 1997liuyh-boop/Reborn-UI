{
  "name": "carousel-3d",
  "dependencies": [
    "motion-v",
    "three"
  ],
  "files": [
    {
      "path": "Carousel3D.vue",
      "content": "<template>\r\n  <div\r\n    ref=\"carouselContainer\"\r\n    :class=\"cn('w-full h-[60vh] relative', props.containerClass)\"\r\n  >\r\n    <div\r\n      :class=\"\r\n        cn('absolute top-[40%] translate-y-[-50%] left-0 w-full h-[80%] z-[100]', props.class)\r\n      \"\r\n      @mousedown=\"onDragStart\"\r\n      @mouseup=\"onDragEnd\"\r\n      @mouseleave=\"onDragEnd\"\r\n      @mousemove=\"onMouseMove\"\r\n      @touchstart=\"onTouchStart\"\r\n      @touchend=\"onDragEnd\"\r\n      @touchmove=\"onTouchMove\"\r\n    ></div>\r\n  </div>\r\n</template>\r\n\r\n<script lang=\"ts\" setup>\r\nimport * as THREE from \"three\";\r\nimport { CSS3DRenderer, CSS3DObject } from \"three/addons/renderers/CSS3DRenderer.js\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport type { HTMLAttributes } from \"vue\";\r\nimport { animate, type AnimationPlaybackControls } from \"motion-v\";\r\n\r\ninterface Props {\r\n  items?: unknown[];\r\n  class?: HTMLAttributes[\"class\"];\r\n  containerClass?: HTMLAttributes[\"class\"];\r\n  width?: number;\r\n  height?: number;\r\n}\r\n\r\nconst props = withDefaults(defineProps<Props>(), {\r\n  class: \"\",\r\n  containerClass: \"\",\r\n  width: 450,\r\n  height: 600,\r\n  items: () => [],\r\n});\r\n\r\nconst carouselContainer = ref<HTMLDivElement>();\r\nconst isDragging = ref(false);\r\nconst startX = ref(0);\r\nconst currentX = ref(0);\r\nconst sensitivity = 0.0025; // Adjusted rotation sensitivity for handleDrag\r\n\r\nconst scene = new THREE.Scene();\r\nconst camera = new THREE.PerspectiveCamera(50, 1, 1, 5000);\r\nlet renderer: CSS3DRenderer;\r\n\r\nconst radius = ref(750);\r\nlet carousel: THREE.Object3D;\r\nlet continuousAnimation = ref<AnimationPlaybackControls | null>(null);\r\n\r\nonMounted(() => {\r\n  if (!carouselContainer.value) return;\r\n\r\n  // Setup renderer\r\n  renderer = new CSS3DRenderer();\r\n  const width = carouselContainer.value.clientWidth;\r\n  const height = carouselContainer.value.clientHeight;\r\n\r\n  renderer.setSize(width, height);\r\n  carouselContainer.value.appendChild(renderer.domElement);\r\n\r\n  // Camera setup\r\n  camera.position.z = 550;\r\n  camera.position.y = 70;\r\n\r\n  // Create carousel\r\n  carousel = new THREE.Object3D();\r\n  scene.add(carousel);\r\n\r\n  // Add items\r\n  props.items.forEach((image, index) => {\r\n    const element = document.createElement(\"div\");\r\n    element.style.width = `${props.width}px`;\r\n    element.style.height = `${props.height}px`;\r\n    element.classList.add(\"rounded-lg\");\r\n    element.style.backgroundImage = `url(${image})`;\r\n    element.style.backgroundSize = \"cover\";\r\n\r\n    const object = new CSS3DObject(element);\r\n    const angle = (index / props.items.length) * Math.PI * 2;\r\n    object.position.setFromSphericalCoords(radius.value, Math.PI / 2, angle);\r\n    object.lookAt(carousel.position);\r\n\r\n    carousel.add(object);\r\n  });\r\n\r\n  // Initial rotation\r\n  carousel.rotation.x = THREE.MathUtils.degToRad(20);\r\n  startContinuousRotation();\r\n\r\n  window.addEventListener(\"resize\", onWindowResize);\r\n});\r\n\r\nfunction startContinuousRotation() {\r\n  if (continuousAnimation.value) {\r\n    continuousAnimation.value.stop();\r\n  }\r\n\r\n  const fromVal = carousel.rotation.y;\r\n  const toVal = fromVal + Math.PI * 2;\r\n\r\n  continuousAnimation.value = animate(fromVal, toVal, {\r\n    duration: 20,\r\n    ease: \"linear\",\r\n    repeat: Infinity,\r\n    repeatType: \"loop\",\r\n    onUpdate: (latest) => {\r\n      carousel.rotation.y = latest;\r\n      renderer.render(scene, camera);\r\n    },\r\n  });\r\n}\r\n\r\nfunction onDragStart(event: MouseEvent | TouchEvent) {\r\n  isDragging.value = true;\r\n  startX.value = \"touches\" in event ? event.touches[0].clientX : event.clientX;\r\n  currentX.value = startX.value;\r\n\r\n  if (continuousAnimation.value) {\r\n    continuousAnimation.value.stop();\r\n    continuousAnimation.value = null;\r\n  }\r\n}\r\n\r\nfunction onDragEnd() {\r\n  if (!isDragging.value) return;\r\n  isDragging.value = false;\r\n  startContinuousRotation();\r\n}\r\n\r\nfunction onMouseMove(event: MouseEvent) {\r\n  if (!isDragging.value) return;\r\n  handleDrag(event.clientX);\r\n}\r\n\r\nfunction onTouchStart(event: TouchEvent) {\r\n  onDragStart(event);\r\n}\r\n\r\nfunction onTouchMove(event: TouchEvent) {\r\n  if (!isDragging.value) return;\r\n  event.preventDefault();\r\n  handleDrag(event.touches[0].clientX);\r\n}\r\n\r\nfunction handleDrag(clientX: number) {\r\n  const deltaX = clientX - currentX.value;\r\n  currentX.value = clientX;\r\n\r\n  carousel.rotation.y += -deltaX * sensitivity;\r\n  renderer.render(scene, camera);\r\n}\r\n\r\nfunction onWindowResize() {\r\n  if (!carouselContainer.value) return;\r\n\r\n  const width = carouselContainer.value.clientWidth;\r\n  const height = carouselContainer.value.clientHeight;\r\n\r\n  radius.value = width / 3;\r\n  camera.aspect = width / height;\r\n  camera.updateProjectionMatrix();\r\n  renderer.setSize(width, height);\r\n}\r\n\r\nonBeforeUnmount(() => {\r\n  if (carouselContainer.value && renderer) {\r\n    carouselContainer.value.removeChild(renderer.domElement);\r\n  }\r\n  window.removeEventListener(\"resize\", onWindowResize);\r\n\r\n  if (continuousAnimation.value) {\r\n    continuousAnimation.value.stop();\r\n  }\r\n});\r\n</script>\r\n",
      "target": "web"
    },
    {
      "path": "Carousel3D.vue",
      "content": "<template>\r\n  <view\r\n    ref=\"carouselContainer\"\r\n    :class=\"cn('w-full h-[60vh] relative', props.containerClass)\"\r\n  >\r\n    <view\r\n      :class=\"\r\n        cn('absolute top-[40%] translate-y-[-50%] left-0 w-full h-[80%] z-[100]', props.class)\r\n      \"\r\n      @mousedown=\"onDragStart\"\r\n      @mouseup=\"onDragEnd\"\r\n      @mouseleave=\"onDragEnd\"\r\n      @mousemove=\"onMouseMove\"\r\n      @touchstart=\"onTouchStart\"\r\n      @touchend=\"onDragEnd\"\r\n      @touchmove=\"onTouchMove\"\r\n    ></view>\r\n  </view>\r\n</template>\r\n\r\n<script lang=\"ts\" setup>\r\nimport * as THREE from \"three\";\r\nimport { CSS3DRenderer, CSS3DObject } from \"three/addons/renderers/CSS3DRenderer.js\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport type { HTMLAttributes } from \"vue\";\r\nimport { animate, type AnimationPlaybackControls } from \"motion-v\";\r\n\r\ninterface Props {\r\n  items?: unknown[];\r\n  class?: HTMLAttributes[\"class\"];\r\n  containerClass?: HTMLAttributes[\"class\"];\r\n  width?: number;\r\n  height?: number;\r\n}\r\n\r\nconst props = withDefaults(defineProps<Props>(), {\r\n  class: \"\",\r\n  containerClass: \"\",\r\n  width: 450,\r\n  height: 600,\r\n  items: () => [],\r\n});\r\n\r\nconst carouselContainer = ref<HTMLDivElement>();\r\nconst isDragging = ref(false);\r\nconst startX = ref(0);\r\nconst currentX = ref(0);\r\nconst sensitivity = 0.0025; // Adjusted rotation sensitivity for handleDrag\r\n\r\nconst scene = new THREE.Scene();\r\nconst camera = new THREE.PerspectiveCamera(50, 1, 1, 5000);\r\nlet renderer: CSS3DRenderer;\r\n\r\nconst radius = ref(750);\r\nlet carousel: THREE.Object3D;\r\nlet continuousAnimation = ref<AnimationPlaybackControls | null>(null);\r\n\r\nonMounted(() => {\r\n  if (!carouselContainer.value) return;\r\n\r\n  // Setup renderer\r\n  renderer = new CSS3DRenderer();\r\n  const width = carouselContainer.value.clientWidth;\r\n  const height = carouselContainer.value.clientHeight;\r\n\r\n  renderer.setSize(width, height);\r\n  carouselContainer.value.appendChild(renderer.domElement);\r\n\r\n  // Camera setup\r\n  camera.position.z = 550;\r\n  camera.position.y = 70;\r\n\r\n  // Create carousel\r\n  carousel = new THREE.Object3D();\r\n  scene.add(carousel);\r\n\r\n  // Add items\r\n  props.items.forEach((image, index) => {\r\n    const element = document.createElement(\"div\");\r\n    element.style.width = `${props.width}px`;\r\n    element.style.height = `${props.height}px`;\r\n    element.classList.add(\"rounded-lg\");\r\n    element.style.backgroundImage = `url(${image})`;\r\n    element.style.backgroundSize = \"cover\";\r\n\r\n    const object = new CSS3DObject(element);\r\n    const angle = (index / props.items.length) * Math.PI * 2;\r\n    object.position.setFromSphericalCoords(radius.value, Math.PI / 2, angle);\r\n    object.lookAt(carousel.position);\r\n\r\n    carousel.add(object);\r\n  });\r\n\r\n  // Initial rotation\r\n  carousel.rotation.x = THREE.MathUtils.degToRad(20);\r\n  startContinuousRotation();\r\n\r\n  window.addEventListener(\"resize\", onWindowResize);\r\n});\r\n\r\nfunction startContinuousRotation() {\r\n  if (continuousAnimation.value) {\r\n    continuousAnimation.value.stop();\r\n  }\r\n\r\n  const fromVal = carousel.rotation.y;\r\n  const toVal = fromVal + Math.PI * 2;\r\n\r\n  continuousAnimation.value = animate(fromVal, toVal, {\r\n    duration: 20,\r\n    ease: \"linear\",\r\n    repeat: Infinity,\r\n    repeatType: \"loop\",\r\n    onUpdate: (latest) => {\r\n      carousel.rotation.y = latest;\r\n      renderer.render(scene, camera);\r\n    },\r\n  });\r\n}\r\n\r\nfunction onDragStart(event: MouseEvent | TouchEvent) {\r\n  isDragging.value = true;\r\n  startX.value = \"touches\" in event ? event.touches[0].clientX : event.clientX;\r\n  currentX.value = startX.value;\r\n\r\n  if (continuousAnimation.value) {\r\n    continuousAnimation.value.stop();\r\n    continuousAnimation.value = null;\r\n  }\r\n}\r\n\r\nfunction onDragEnd() {\r\n  if (!isDragging.value) return;\r\n  isDragging.value = false;\r\n  startContinuousRotation();\r\n}\r\n\r\nfunction onMouseMove(event: MouseEvent) {\r\n  if (!isDragging.value) return;\r\n  handleDrag(event.clientX);\r\n}\r\n\r\nfunction onTouchStart(event: TouchEvent) {\r\n  onDragStart(event);\r\n}\r\n\r\nfunction onTouchMove(event: TouchEvent) {\r\n  if (!isDragging.value) return;\r\n  event.preventDefault();\r\n  handleDrag(event.touches[0].clientX);\r\n}\r\n\r\nfunction handleDrag(clientX: number) {\r\n  const deltaX = clientX - currentX.value;\r\n  currentX.value = clientX;\r\n\r\n  carousel.rotation.y += -deltaX * sensitivity;\r\n  renderer.render(scene, camera);\r\n}\r\n\r\nfunction onWindowResize() {\r\n  if (!carouselContainer.value) return;\r\n\r\n  const width = carouselContainer.value.clientWidth;\r\n  const height = carouselContainer.value.clientHeight;\r\n\r\n  radius.value = width / 3;\r\n  camera.aspect = width / height;\r\n  camera.updateProjectionMatrix();\r\n  renderer.setSize(width, height);\r\n}\r\n\r\nonBeforeUnmount(() => {\r\n  if (carouselContainer.value && renderer) {\r\n    carouselContainer.value.removeChild(renderer.domElement);\r\n  }\r\n  window.removeEventListener(\"resize\", onWindowResize);\r\n\r\n  if (continuousAnimation.value) {\r\n    continuousAnimation.value.stop();\r\n  }\r\n});\r\n</script>\r\n",
      "target": "uniapp"
    }
  ],
  "fileCount": 2,
  "contentHash": "f2233b4864424ebc8f3a059a43f2dad91a84877c"
}
